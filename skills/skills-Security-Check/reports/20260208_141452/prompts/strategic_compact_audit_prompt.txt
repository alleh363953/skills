
# è³‡å®‰å°ˆå®¶ AI å¯©æŸ¥ä»»å‹™

è«‹æ‰®æ¼”ä¸€ä½è³‡æ·±è³‡å®‰å·¥ç¨‹å¸«ï¼Œé‡å°ä»¥ä¸‹ Skill é€²è¡Œæ·±åº¦å®‰å…¨å¯©æŸ¥ã€‚
ä½ çš„ç›®æ¨™æ˜¯è­˜åˆ¥æ½›åœ¨æƒ¡æ„ä»£ç¢¼ã€ä¾›æ‡‰éˆæ”»æ“Šé¢¨éšªä»¥åŠéš±ç§æ´©éœ²å•é¡Œã€‚

## 1. å°ˆæ¡ˆåŸºæœ¬è³‡è¨Š
- **åç¨±**: strategic-compact
- **è·¯å¾‘**: skills\strategic-compact

## 2. æª”æ¡ˆçµæ§‹ (File Tree)
```text
    SKILL.md
    suggest-compact.sh
```

## 3. ä¾›æ‡‰éˆä¾è³´ (Supply Chain Dependencies)
è«‹ç‰¹åˆ¥æª¢æŸ¥ä»¥ä¸‹å¤–éƒ¨å¥—ä»¶æ˜¯å¦å­˜åœ¨å·²çŸ¥æƒ¡æ„è»Ÿé«”æˆ–è¢«æ¿«ç”¨çš„æ­·å² (å¦‚ Typosquatting):
æ­¤ Skill æœªåµæ¸¬åˆ°æ˜ç¢ºçš„å¥—ä»¶ä¾è³´æ–‡ä»¶ã€‚

## 4. éœæ…‹æƒæç™¼ç¾çš„å¯ç–‘ç†±é» (Scanner Findings)
ä»¥ä¸‹æ˜¯é€é Regex è…³æœ¬åµæ¸¬åˆ°çš„å¯ç–‘ç‰¹å¾µï¼Œè«‹é‡é»æª¢æŸ¥é€™äº›ä½ç½®çš„ä¸Šä¸‹æ–‡æ„åœ–ï¼š
- https://x.com/affaanmustafa/status/2014040193557471352
- ç¡¬ç·¨ç¢¼æ†‘è­‰é—œéµå­— (API Key/Token/Secret)ï¼šskills\strategic-compact\SKILL.md

## 5. å°ˆæ¡ˆæ ¸å¿ƒèˆ‡é—œéµæª”æ¡ˆå…§å®¹ (Source Code)
ä»¥ä¸‹åŒ…å«å°ˆæ¡ˆçš„èªªæ˜æ–‡ä»¶ (SKILL.md) ä»¥åŠä¸Šè¿°åµæ¸¬åˆ°é¢¨éšªçš„é—œéµç¨‹å¼ç¢¼ã€‚
è«‹ä»”ç´°é–±è®€ç¨‹å¼é‚è¼¯ï¼Œåˆ¤æ–·æ˜¯å¦å­˜åœ¨ã€Œæƒ¡æ„æ„åœ–ã€æˆ–ã€Œéš±è—é‚è¼¯æ¼æ´ã€ã€‚

### ğŸ“„ æ–‡ä»¶: SKILL.md
```markdown
---
name: strategic-compact
description: Suggests manual context compaction at logical intervals to preserve context through task phases rather than arbitrary auto-compaction.
---

# Strategic Compact Skill

Suggests manual `/compact` at strategic points in your workflow rather than relying on arbitrary auto-compaction.

## Why Strategic Compaction?

Auto-compaction triggers at arbitrary points:
- Often mid-task, losing important context
- No awareness of logical task boundaries
- Can interrupt complex multi-step operations

Strategic compaction at logical boundaries:
- **After exploration, before execution** - Compact research context, keep implementation plan
- **After completing a milestone** - Fresh start for next phase
- **Before major context shifts** - Clear exploration context before different task

## How It Works

The `suggest-compact.sh` script runs on PreToolUse (Edit/Write) and:

1. **Tracks tool calls** - Counts tool invocations in session
2. **Threshold detection** - Suggests at configurable threshold (default: 50 calls)
3. **Periodic reminders** - Reminds every 25 calls after threshold

## Hook Setup

Add to your `~/.claude/settings.json`:

```json
{
  "hooks": {
    "PreToolUse": [{
      "matcher": "tool == \"Edit\" || tool == \"Write\"",
      "hooks": [{
        "type": "command",
        "command": "~/.claude/skills/strategic-compact/suggest-compact.sh"
      }]
    }]
  }
}
```

## Configuration

Environment variables:
- `COMPACT_THRESHOLD` - Tool calls before first suggestion (default: 50)

## Best Practices

1. **Compact after planning** - Once plan is finalized, compact to start fresh
2. **Compact after debugging** - Clear error-resolution context before continuing
3. **Don't compact mid-implementation** - Preserve context for related changes
4. **Read the suggestion** - The hook tells you *when*, you decide *if*

## Related

- [The Longform Guide](https://x.com/affaanmustafa/status/2014040193557471352) - Token optimization section
- Memory persistence hooks - For state that survives compaction

```

---

## ä½ çš„ä»»å‹™ (Output Format)
è«‹æ ¹æ“šä»¥ä¸Šè³‡è¨Šï¼Œåˆ†ææ­¤ Skill æ˜¯å¦å®‰å…¨ã€‚è«‹å›ç­”ï¼š

1.  **åŠŸèƒ½ç¸½çµ**ï¼šå®ƒåˆ°åº•æ˜¯åšä»€éº¼çš„ï¼Ÿä»£ç¢¼é‚è¼¯æ˜¯å¦ç¬¦åˆ SKILL.md çš„æè¿°ï¼Ÿ
2.  **ä¾›æ‡‰éˆåˆ†æ**ï¼šä½¿ç”¨çš„å¤–éƒ¨åº«æ˜¯å¦åˆç†ï¼Ÿæœ‰ç„¡å¯ç–‘æˆ–å†·é–€çš„ä¾è³´é …ï¼Ÿ
3.  **é¢¨éšªé©—è­‰**ï¼šéœæ…‹æƒæåˆ°çš„ã€Œç†±é»ã€æ˜¯æƒ¡æ„çš„å—ï¼Ÿé‚„æ˜¯æ­£å¸¸åŠŸèƒ½ï¼Ÿ(ä¾‹å¦‚ï¼ševal ç”¨æ–¼è¨ˆç®—æ©Ÿæ˜¯ä½é¢¨éšªï¼Œç”¨æ–¼åŸ·è¡Œå¤–éƒ¨è…³æœ¬æ˜¯é«˜é¢¨éšª)
4.  **éš±è—å¾Œé–€åˆ†æ**ï¼šé™¤äº† regex æŠ“åˆ°çš„ï¼Œä½ æœ‰çœ‹åˆ°å…¶ä»–å¥‡æ€ªé‚è¼¯å—ï¼Ÿ(ä¾‹å¦‚ï¼šç‰¹å®šæ¢ä»¶ä¸‹è§¸ç™¼ã€æ™‚é–“ç‚¸å½ˆã€å¯«æ­»å¥‡æ€ªçš„è®Šæ•¸)
5.  **æœ€çµ‚åˆ¤æ±º**ï¼š
    *   ğŸŸ¢ **é€šé** (Safe)
    *   ğŸŸ¡ **è­¦å‘Š** (Suspicious - éœ€äººå·¥è¦†æ ¸)
    *   ğŸ”´ **å±éšª** (Malicious - ç¦æ­¢å®‰è£)

è«‹çµ¦å‡ºç°¡çŸ­æœ‰åŠ›çš„çµè«– (ç¹é«”ä¸­æ–‡)ã€‚
